<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= vehicle.year %> <%= vehicle.make %> <%= vehicle.model %> - Before You Sign</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <%- include('../partials/favicon.ejs')%>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 0 0% 0%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --radius: 0.75rem;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.5;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background-color: hsl(var(--card));
            border-bottom: 1px solid hsl(var(--border));
            padding: 16px 0;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .nav-item {
            color: hsl(var(--foreground));
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-item:hover {
            color: hsl(var(--primary));
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .primary-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            text-decoration: none;
        }

        .primary-button:hover {
            opacity: 0.9;
        }

        .outline-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .outline-button:hover {
            background-color: hsl(var(--secondary));
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: auto;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 32px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 30px;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Card */
        .card {
            background-color: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid hsl(var(--border));
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .card-description {
            font-size: 14px;
            color: hsl(var(--muted-foreground));
        }

        .card-content {
            padding: 24px;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background-color: #dbeafe;
            color: #1e40af;
        }

        /* Alert */
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .info-section {
            display: flex;
            flex-direction: column;
        }

        .info-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .info-content {
            flex: 1;
        }

        /* Table */
        .info-table {
            width: 100%;
            border-collapse: collapse;
        }

        .info-table td {
            padding: 12px 16px;
            border-bottom: 1px solid hsl(var(--border));
        }

        .info-table tr:last-child td {
            border-bottom: none;
        }

        .info-table strong {
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .info-table .monospace {
            font-family: monospace;
            background-color: hsl(var(--secondary));
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* QR Code */
        .qr-container {
            text-align: center;
            margin-top: 16px;
        }

        .qr-code {
            max-width: 150px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .qr-text {
            color: hsl(var(--muted-foreground));
            font-size: 14px;
        }

        /* History Section */
        .history-section {
            margin-bottom: 24px;
        }

        .history-section:last-child {
            margin-bottom: 0;
        }

        .history-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .history-content {
            background-color: hsl(var(--secondary));
            padding: 16px;
            border-radius: 8px;
            white-space: pre-line;
        }

        /* License Numbers */
        .license-list {
            padding-left: 20px;
            margin: 12px 0;
        }

        .license-list li {
            margin-bottom: 6px;
        }

        /* System Info */
        .system-info {
            display: flex;
            gap: 30px;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 24px;
        }

        .hero-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .hero-info {
            flex: 1;
            min-width: 280px;
        }

        .vehicle-price {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .hero-badges {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .hero-qr {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Contact Section */
        .contact-section {
            border: 2px solid hsl(var(--primary));
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        /* Report Section */
        .report-section {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .info-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 16px;
            }

            .nav-links {
                gap: 16px;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
                flex-wrap: wrap;
            }

            .outline-button {
                width: 100%;
                justify-content: center;
            }

            .system-info {
                flex-direction: column;
                gap: 10px;
            }

            .hero-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
    <style>
        /* Image Gallery Styles */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid hsl(var(--border));
            aspect-ratio: 4/3;
        }

        .gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover .image-overlay {
            opacity: 1;
        }

        .image-overlay i {
            color: white;
            font-size: 2rem;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .image-modal.active {
            display: flex;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 50px;
            font-weight: 300;
            cursor: pointer;
            z-index: 10002;
            transition: color 0.3s ease;
            line-height: 1;
        }

        .modal-close:hover {
            color: #ccc;
        }

        .modal-image {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            animation: zoomIn 0.3s ease;
        }

        .modal-navigation {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10001;
            pointer-events: none;
        }

        .nav-btn {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .image-counter {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 10002;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { 
            opacity: 0;
            transform: scale(0.8);
            }
            to { 
            opacity: 1;
            transform: scale(1);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .image-gallery {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            }

            .modal-close {
            top: 10px;
            right: 20px;
            font-size: 40px;
            }

            .nav-btn {
            width: 40px;
            height: 40px;
            font-size: 1rem;
            }

            .modal-navigation {
            padding: 0 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <a href="/" style="text-decoration: none; color: inherit;">
                    <div class="logo-container">
                        <img src="/assets/logo-no-bg.png" alt="" style="width: 250px; height: auto;">
                    </div>
                </a>
                
                <nav class="nav-links">
                    <a href="/customer/vehicles" class="nav-item">Browse Vehicles</a>
                    <a href="/about" class="nav-item">How It Works</a>
                    <a href="/dealerships" class="nav-item">Dealerships</a>
                    <a href="/support" class="nav-item">Support</a>
                </nav>
                
                <div class="user-actions">
                    <a href="/login" class="outline-button">Login</a>
                    <a href="/register" class="primary-button">Sign Up</a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="dashboard-content">
                <div class="dashboard-header">
                    <h1 class="page-title"><%= vehicle.year %> <%= vehicle.make %> <%= vehicle.model %></h1>
                    <div class="header-actions">
                        <a href="/customer/vehicles" class="outline-button">
                            <i class="fas fa-arrow-left"></i>
                            Back to Vehicles
                        </a>
                    </div>
                </div>

                <!-- Hero Section with Price and QR Code -->
                <div class="hero-section" style="background: black">
                    <div class="hero-content">
                        <div class="hero-info">
                            <div class="vehicle-price">
                                R <%= vehicle.price.toLocaleString() %>
                            </div>
                            <p style="font-size: 1.1rem; margin-bottom: 10px;">
                                <i class="fas fa-building"></i> <strong><%= vehicle.business_name %></strong>
                                <% if (vehicle.certification_status === 'active') { %>
                                    <span class="badge badge-success" style="margin-left: 10px;">
                                        <i class="fas fa-shield-check"></i> Certified Dealership
                                    </span>
                                <% } %>
                            </p>
                            <p style="font-size: 1rem; opacity: 0.9;">
                                <i class="fas fa-road"></i> <%= vehicle.mileage.toLocaleString() %> km
                                &nbsp;•&nbsp;
                                <i class="fas fa-calendar"></i> <%= vehicle.year %>
                                &nbsp;•&nbsp;
                                <span style="text-transform: capitalize;"><%= vehicle.vehicle_status || 'Used' %></span>
                            </p>
                            <div class="hero-badges">
                                <span class="badge badge-success" style="font-size: 1rem; padding: 8px 16px;">
                                    <i class="fas fa-check-circle"></i> Independently Verified
                                </span>
                            </div>
                        </div>
                        
                        <% if (vehicle.qr_code_path) { %>
                            <div class="hero-qr">
                                <p style="color: #374151; font-weight: 600; margin-bottom: 10px;">
                                    <i class="fas fa-qrcode" style="color: hsl(var(--primary));"></i> 
                                    Scan for Instant History
                                </p>
                                <img src="<%= vehicle.qr_code_path %>" alt="Vehicle QR Code" style="max-width: 180px; border: 3px solid hsl(var(--primary)); border-radius: 8px;">
                                <p style="color: #6b7280; font-size: 0.875rem; margin-top: 8px;">
                                    Full verification details
                                </p>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Vehicle Identification -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Vehicle Identification</h3>
                        <p class="card-description">Official identification numbers and details</p>
                    </div>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
                            <div style="padding: 15px; background: hsl(var(--secondary)); border-radius: 8px; border-left: 4px solid hsl(var(--primary));">
                                <small style="color: hsl(var(--muted-foreground)); display: block; margin-bottom: 5px; font-weight: 600;">VIN</small>
                                <strong style="font-family: monospace; font-size: 1.1rem; color: hsl(var(--text));"><%= vehicle.vin %></strong>
                            </div>
                            <div style="padding: 15px; background: hsl(var(--secondary)); border-radius: 8px; border-left: 4px solid hsl(var(--primary));">
                                <small style="color: hsl(var(--muted-foreground)); display: block; margin-bottom: 5px; font-weight: 600;">Plate Number</small>
                                <strong style="font-family: monospace; font-size: 1.1rem; color: hsl(var(--text));"><%= vehicle.plate_number %></strong>
                            </div>
                            <div style="padding: 15px; background: hsl(var(--secondary)); border-radius: 8px; border-left: 4px solid hsl(var(--primary));">
                                <small style="color: hsl(var(--muted-foreground)); display: block; margin-bottom: 5px; font-weight: 600;">Engine Number</small>
                                <strong style="font-family: monospace; font-size: 1.1rem; color: hsl(var(--text));"><%= vehicle.engine_number %></strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Verification Status -->
                <div class="card" style="background: #ecfdf5; border-left: 4px solid #10b981;">
                    <div class="card-header">
                        <h3 class="card-title" style="color: #065f46;">
                            <i class="fas fa-shield-check"></i> Verification Details
                        </h3>
                        <p class="card-description" style="color: #047857;">Independent verification information</p>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div>
                                <p><strong>Status:</strong> <span class="badge badge-success">Verified</span></p>
                                <p><strong>Verified Date:</strong> <%= new Date(vehicle.verified_at).toLocaleDateString() %></p>
                                <% if (vehicle.verification_notes) { %>
                                    <p><strong>Admin Notes:</strong> <%= vehicle.verification_notes %></p>
                                <% } %>
                            </div>
                            <div>
                                <p style="color: #065f46; line-height: 1.6;">
                                    <i class="fas fa-info-circle"></i> 
                                    This vehicle has been independently verified by our admin team. 
                                    All information displayed has been checked against official records and documentation.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Photos -->
                <% if (vehicle.image_urls) { %>
                <% try { %>
                    <% const images = JSON.parse(vehicle.image_urls); %>
                    <% if (images && images.length > 0) { %>
                    <div class="card">
                        <div class="card-header">
                        <h3 class="card-title">Vehicle Photos</h3>
                        <p class="card-description">High-quality images of the vehicle (<%= images.length %> photo<%= images.length !== 1 ? 's' : '' %>)</p>
                        </div>
                        <div class="card-content">
                        <div class="image-gallery">
                            <% images.forEach((img, index) => { %>
                            <div class="gallery-item" onclick="openImageModal('<%= img %>', <%= index %>)">
                                <img src="<%= img %>" alt="Vehicle image <%= index + 1 %>" loading="lazy">
                                <div class="image-overlay">
                                <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <% }); %>
                        </div>
                        </div>
                    </div>
                    <% } %>
                <% } catch(e) { %>
                    <!-- Error parsing images -->
                <% } %>
                <% } %>

                <!-- Registration & Legal Information -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Registration & Legal Information</h3>
                        <p class="card-description">Official registration details and legal status</p>
                    </div>
                    <div class="card-content">
                        <table class="info-table">
                            <tr>
                                <td><strong>Registration Authority:</strong></td>
                                <td><%= vehicle.registration_authority || 'Not provided' %></td>
                                <td><strong>Vehicle Status:</strong></td>
                                <td style="text-transform: capitalize;"><%= vehicle.vehicle_status || 'Not provided' %></td>
                            </tr>
                            <tr>
                                <td><strong>Date Liable for Licensing:</strong></td>
                                <td>
                                    <%= vehicle.date_liability_licensing ? new Date(vehicle.date_liability_licensing).toLocaleDateString() : 'Not provided' %>
                                    <% if (vehicle.date_liability_licensing) { %>
                                        <% const licensingDate = new Date(vehicle.date_liability_licensing); %>
                                        <% const today = new Date(); %>
                                        <% const daysUntil = Math.ceil((licensingDate - today) / (1000 * 60 * 60 * 24)); %>
                                        <% if (daysUntil < 0) { %>
                                            <span class="badge badge-danger">Overdue</span>
                                        <% } else if (daysUntil < 30) { %>
                                            <span class="badge badge-warning">Due Soon</span>
                                        <% } else { %>
                                            <span class="badge badge-success">Current</span>
                                        <% } %>
                                    <% } %>
                                </td>
                                <td><strong>Date Liable for Registration:</strong></td>
                                <td><%= vehicle.date_liable_registration ? new Date(vehicle.date_liable_registration).toLocaleDateString() : 'Not provided' %></td>
                            </tr>
                            <tr>
                                <td><strong>Tare Weight (kg):</strong></td>
                                <td><%= vehicle.tare_weight ? vehicle.tare_weight + ' kg' : 'Not provided' %></td>
                                <td><strong>Previous Owners:</strong></td>
                                <td>
                                    <%= vehicle.previous_owners %>
                                    <% if (vehicle.previous_owners === 0) { %>
                                        <span class="badge badge-success">First Owner</span>
                                    <% } else if (vehicle.previous_owners === 1) { %>
                                        <span class="badge badge-info">One Previous Owner</span>
                                    <% } %>
                                </td>
                            </tr>
                        </table>
                        
                        <% if (vehicle.license_numbers) { 
                            try {
                                const licenseNums = JSON.parse(vehicle.license_numbers); 
                                if (licenseNums.length > 0) { %>
                        <div style="margin-top: 20px;">
                            <h4 style="margin-bottom: 12px;">License Numbers (last 3, most recent first)</h4>
                            <ul class="license-list">
                                <% licenseNums.forEach((num, idx) => { %>
                                    <li><strong><%= idx === 0 ? 'Current' : `Previous ${idx}` %>:</strong> <code class="monospace"><%= num %></code></li>
                                <% }) %>
                            </ul>
                        </div>
                        <% } } catch(e) { } } %>
                    </div>
                </div>

                <!-- Vehicle Specifications -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Vehicle Specifications</h3>
                        <p class="card-description">Technical details and specifications</p>
                    </div>
                    <div class="card-content">
                        <table class="info-table">
                            <tr>
                                <td><strong>Make:</strong></td>
                                <td><%= vehicle.make %></td>
                                <td><strong>Model:</strong></td>
                                <td><%= vehicle.model %></td>
                            </tr>
                            <tr>
                                <td><strong>Year:</strong></td>
                                <td><%= vehicle.year %></td>
                                <td><strong>Color:</strong></td>
                                <td><%= vehicle.color || '-' %></td>
                            </tr>
                            <tr>
                                <td><strong>Body Type:</strong></td>
                                <td><%= vehicle.body_type || '-' %></td>
                                <td><strong>Transmission:</strong></td>
                                <td><%= vehicle.transmission || '-' %></td>
                            </tr>
                            <tr>
                                <td><strong>Engine Type:</strong></td>
                                <td><%= vehicle.engine_type || '-' %></td>
                                <td><strong>Engine Capacity:</strong></td>
                                <td><%= vehicle.engine_capacity || '-' %></td>
                            </tr>
                            <tr>
                                <td><strong>Fuel Type:</strong></td>
                                <td>
                                    <%= vehicle.fuel_type || '-' %>
                                    <% if (vehicle.fuel_type === 'Electric') { %>
                                        <span class="badge badge-success">
                                            <i class="fas fa-leaf"></i> Zero Emissions
                                        </span>
                                    <% } else if (vehicle.fuel_type === 'Hybrid' || vehicle.fuel_type === 'Plug-in Hybrid') { %>
                                        <span class="badge badge-info">
                                            <i class="fas fa-leaf"></i> Eco-Friendly
                                        </span>
                                    <% } %>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Mileage Verification -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Mileage Information</h3>
                        <p class="card-description">Verified mileage details</p>
                    </div>
                    <div class="card-content">
                        <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: hsl(var(--secondary)); border-radius: 8px; border-left: 4px solid hsl(var(--primary));">
                            <div style="font-size: 3rem; color: hsl(var(--primary));">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div>
                                <p style="font-size: 2rem; font-weight: 700; color: hsl(var(--text)); margin: 0;">
                                    <%= vehicle.mileage.toLocaleString() %> km
                                </p>
                                <p style="color: #1e40af; margin: 5px 0 0 0;">
                                    <i class="fas fa-check-circle"></i> Mileage verified against service records
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehicle History -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Vehicle History</h3>
                        <p class="card-description">Service, accident, and recall history</p>
                    </div>
                    <div class="card-content">
                        <div class="history-section">
                            <h4 class="history-title">Service History</h4>
                            <div class="history-content">
                                <%= vehicle.service_history || 'Not provided' %>
                            </div>
                        </div>
                        
                        <div class="history-section">
                            <h4 class="history-title">Accident History</h4>
                            <div class="history-content">
                                <%= vehicle.accident_history || 'Not provided' %>
                            </div>
                        </div>
                        
                        <div class="history-section">
                            <h4 class="history-title">Recall Information</h4>
                            <div class="history-content">
                                <%= vehicle.recall_information || 'Not provided' %>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Features -->
                <% if (vehicle.additional_features) { %>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Additional Features</h3>
                        <p class="card-description">Extra features and equipment</p>
                    </div>
                    <div class="card-content">
                        <div class="history-content">
                            <%= vehicle.additional_features %>
                        </div>
                    </div>
                </div>
                <% } %>

                <!-- Description -->
                <% if (vehicle.description) { %>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Description</h3>
                        <p class="card-description">Additional notes and description</p>
                    </div>
                    <div class="card-content">
                        <div class="history-content">
                            <%= vehicle.description %>
                        </div>
                    </div>
                </div>
                <% } %>

                <!-- Dealership Contact Information -->
                <div class="contact-section">
                    <h3 class="card-title"><i class="fas fa-building"></i> Contact Dealership</h3>
                    <div class="contact-grid">
                        <div>
                            <h4 style="color: hsl(var(--primary)); margin-bottom: 10px;"><%= vehicle.business_name %></h4>
                            <p><i class="fas fa-phone"></i> <strong>Phone:</strong> <%= vehicle.phone %></p>
                            <p><i class="fas fa-envelope"></i> <strong>Email:</strong> <%= vehicle.email %></p>
                            <% if (vehicle.website) { %>
                                <p><i class="fas fa-globe"></i> <strong>Website:</strong> <a href="<%= vehicle.website %>" target="_blank"><%= vehicle.website %></a></p>
                            <% } %>
                        </div>
                        <div>
                            <% if (vehicle.certification_status === 'active') { %>
                                <div style="padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
                                    <p style="margin: 0; color: #065f46; font-weight: 600;">
                                        <i class="fas fa-check-circle" style="color: #10b981;"></i> 
                                        Certified Ethical Dealership
                                    </p>
                                    <p style="margin: 8px 0 0 0; color: #047857; font-size: 0.9rem;">
                                        This dealership has been verified and certified by Before You Sign for transparency and ethical practices.
                                    </p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Report Discrepancy Section -->
                <div class="report-section">
                    <h3 style="color: #92400e;">
                        <i class="fas fa-exclamation-triangle"></i> Found an Issue?
                    </h3>
                    <p style="color: #78350f; line-height: 1.6; margin-top: 10px;">
                        If you find any discrepancies in the vehicle information or have concerns about this listing, 
                        you can report it through our dispute resolution system. We take all reports seriously and 
                        will investigate thoroughly.
                    </p>
                    <div style="margin-top: 20px;">
                        <% if (role === 'customer') { %>
                            <a href="/customer/report-dispute?vehicleId=<%= vehicle.id %>" class="primary-button" style="background-color: #dc2626; font-size: 1rem; padding: 12px 24px;">
                                <i class="fas fa-exclamation-triangle"></i> Report Discrepancy
                            </a>
                        <% } else { %>
                            <a href="/login?redirect=/customer/report-dispute?vehicleId=<%= vehicle.id %>" class="primary-button" style="background-color: #dc2626; font-size: 1rem; padding: 12px 24px;">
                                <i class="fas fa-sign-in-alt"></i> Login to Report Issue
                            </a>
                        <% } %>
                    </div>
                </div>

                <!-- Back to Browsing -->
                <div style="margin-top: 30px; text-align: center;">
                    <a href="/customer/vehicles" class="primary-button" style="font-size: 1rem; padding: 12px 30px;">
                        <i class="fas fa-arrow-left"></i> Continue Browsing Vehicles
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="modal-close">&times;</span>
        <div class="modal-navigation">
            <button class="nav-btn prev-btn" onclick="event.stopPropagation(); navigateImage(-1)">
            <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-btn next-btn" onclick="event.stopPropagation(); navigateImage(1)">
            <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <img id="modalImage" class="modal-image" onclick="event.stopPropagation()">
        <div class="image-counter" id="imageCounter"></div>
    </div>

    <script>
        let currentImageIndex = 0;
        let imageArray = [];

        function openImageModal(imageSrc, index) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const counter = document.getElementById('imageCounter');
            
            // Get all images if not already stored
            if (imageArray.length === 0) {
            <% if (vehicle.image_urls) { %>
                <% try { %>
                <% const imgs = JSON.parse(vehicle.image_urls); %>
                imageArray = <%= JSON.stringify(imgs) %>;
                <% } catch(e) {} %>
            <% } %>
            }
            
            currentImageIndex = index;
            modal.classList.add('active');
            modalImg.src = imageSrc;
            counter.textContent = `${currentImageIndex + 1} / ${imageArray.length}`;
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function navigateImage(direction) {
            currentImageIndex += direction;
            
            // Loop around
            if (currentImageIndex < 0) {
            currentImageIndex = imageArray.length - 1;
            } else if (currentImageIndex >= imageArray.length) {
            currentImageIndex = 0;
            }
            
            const modalImg = document.getElementById('modalImage');
            const counter = document.getElementById('imageCounter');
            
            // Add fade effect
            modalImg.style.opacity = '0';
            setTimeout(() => {
            modalImg.src = imageArray[currentImageIndex];
            modalImg.style.opacity = '1';
            counter.textContent = `${currentImageIndex + 1} / ${imageArray.length}`;
            updateNavigationButtons();
            }, 150);
        }

        function updateNavigationButtons() {
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            // Disable buttons if only one image
            if (imageArray.length <= 1) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            } else {
            prevBtn.style.display = 'flex';
            nextBtn.style.display = 'flex';
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.classList.contains('active')) {
            if (e.key === 'Escape') {
                closeImageModal();
            } else if (e.key === 'ArrowLeft') {
                navigateImage(-1);
            } else if (e.key === 'ArrowRight') {
                navigateImage(1);
            }
            }
        });
    </script>
</body>
</html>