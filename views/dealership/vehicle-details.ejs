<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <%- include('../partials/header') %>
  
  <div class="container">
    <div style="margin-bottom: 20px;">
      <a href="/dealership/vehicles" class="btn btn-secondary">&larr; Back to Vehicles</a>
    </div>
    
    <h1><%= vehicle.year %> <%= vehicle.make %> <%= vehicle.model %></h1>
    
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 30px;">
        <div style="flex: 1; min-width: 300px;">
          <h2>Status</h2>
          <p style="margin: 15px 0;">
            <% if (vehicle.status === 'verified') { %>
              <span class="badge badge-success" style="font-size: 1.1rem; padding: 10px 20px;">✓ Verified</span>
            <% } else if (vehicle.status === 'pending_verification') { %>
              <span class="badge badge-warning" style="font-size: 1.1rem; padding: 10px 20px;">⏳ Pending Verification</span>
            <% } else { %>
              <span class="badge badge-danger" style="font-size: 1.1rem; padding: 10px 20px;">✗ Rejected</span>
            <% } %>
          </p>
          
          <% if (vehicle.status === 'verified') { %>
            <p style="color: var(--success); margin-top: 10px;">
              <strong>Verified on:</strong> <%= new Date(vehicle.verified_at).toLocaleDateString() %>
            </p>
            <% if (vehicle.verification_notes) { %>
              <p style="margin-top: 10px;">
                <strong>Admin Notes:</strong><br>
                <%= vehicle.verification_notes %>
              </p>
            <% } %>
          <% } else if (vehicle.status === 'rejected' && vehicle.rejection_reason) { %>
            <div class="alert alert-error" style="margin-top: 15px;">
              <strong>Rejection Reason:</strong><br>
              <%= vehicle.rejection_reason %>
            </div>
            <p style="margin-top: 10px; color: var(--text-light);">
              Please contact support or update the vehicle information and resubmit.
            </p>
          <% } else { %>
            <p style="color: var(--text-light); margin-top: 10px;">
              Your vehicle is awaiting admin verification. This typically takes 1-2 business days.
            </p>
          <% } %>
        </div>
        
        <% if (vehicle.qr_code_path) { %>
          <div style="text-align: center; padding: 20px; background: var(--background); border-radius: 8px;">
            <p><strong>QR Code</strong></p>
            <img src="<%= vehicle.qr_code_path %>" alt="Vehicle QR Code" style="max-width: 200px; margin-top: 10px; border: 4px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
            <p style="font-size: 0.875rem; color: var(--text-light); margin-top: 10px;">Customers can scan this code</p>
          </div>
        <% } %>
      </div>
    </div>
    
    <div class="card">
      <h2>Vehicle Information</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
        <div>
          <p><strong>VIN:</strong></p>
          <p style="font-family: monospace; background: var(--background); padding: 8px; border-radius: 4px;"><%= vehicle.vin %></p>
        </div>
        
        <div>
          <p><strong>Price:</strong></p>
          <p style="font-size: 1.5rem; color: var(--primary); font-weight: bold;">R <%= vehicle.price.toLocaleString() %></p>
        </div>
        
        <div>
          <p><strong>Mileage:</strong></p>
          <p style="font-size: 1.2rem;"><%= vehicle.mileage.toLocaleString() %> km</p>
        </div>
      </div>
      
      <table class="table" style="margin-top: 30px;">
        <tr>
          <td><strong>Make:</strong></td>
          <td><%= vehicle.make %></td>
          <td><strong>Model:</strong></td>
          <td><%= vehicle.model %></td>
        </tr>
        <tr>
          <td><strong>Year:</strong></td>
          <td><%= vehicle.year %></td>
          <td><strong>Color:</strong></td>
          <td><%= vehicle.color || 'Not specified' %></td>
        </tr>
        <tr>
          <td><strong>Body Type:</strong></td>
          <td><%= vehicle.body_type || 'Not specified' %></td>
          <td><strong>Fuel Type:</strong></td>
          <td><%= vehicle.fuel_type || 'Not specified' %></td>
        </tr>
        <tr>
          <td><strong>Transmission:</strong></td>
          <td><%= vehicle.transmission || 'Not specified' %></td>
          <td><strong>Previous Owners:</strong></td>
          <td><%= vehicle.previous_owners %></td>
        </tr>
      </table>
    </div>
    
    <div class="card">
      <h2>Vehicle History</h2>
      
      <h3 style="margin-top: 20px;">Service History</h3>
      <p style="white-space: pre-wrap;"><%= vehicle.service_history || 'Not provided' %></p>
      
      <h3 style="margin-top: 30px;">Accident History</h3>
      <p style="white-space: pre-wrap;"><%= vehicle.accident_history || 'Not provided' %></p>
      
      <h3 style="margin-top: 30px;">Recall Information</h3>
      <p style="white-space: pre-wrap;"><%= vehicle.recall_information || 'Not provided' %></p>
      
      <% if (vehicle.additional_features) { %>
        <h3 style="margin-top: 30px;">Additional Features</h3>
        <p style="white-space: pre-wrap;"><%= vehicle.additional_features %></p>
      <% } %>
      
      <% if (vehicle.description) { %>
        <h3 style="margin-top: 30px;">Description</h3>
        <p style="white-space: pre-wrap;"><%= vehicle.description %></p>
      <% } %>
    </div>
    
    <div class="card">
      <h3>System Information</h3>
      <p><strong>Added:</strong> <%= new Date(vehicle.created_at).toLocaleString() %></p>
      <p><strong>Last Updated:</strong> <%= new Date(vehicle.updated_at).toLocaleString() %></p>
    </div>
    
    <div style="margin-top: 20px; display: flex; gap: 15px;">
      <a href="/dealership/vehicles" class="btn btn-secondary">Back to Vehicles</a>
      <% if (vehicle.status === 'pending_verification') { %>
        <form method="POST" action="/dealership/vehicle/<%= vehicle.id %>/delete" style="display: inline;">
          <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this vehicle? This action cannot be undone.')">Delete Vehicle</button>
        </form>
      <% } %>
    </div>
  </div>
  
  <%- include('../partials/footer') %>
</body>
</html>
